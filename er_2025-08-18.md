```mermaid
erDiagram
    users {
        integer user_id PK "ユーザーID"
        string username UK "ユーザー名"
        string email UK "メールアドレス"
        string password_hash "パスワードハッシュ"
        string profile_picture_url "プロフィール画像URL"
        text bio "自己紹介"
        string location "居住エリア"
        string gender "性別"
        date birth_date "生年月日"
        datetime created_at "作成日時"
        datetime updated_at "更新日時"
    }

    social_logins {
        integer social_login_id PK "ソーシャルログインID"
        integer user_id FK "ユーザーID"
        string provider "プロバイダー (google, facebook, apple)"
        string provider_user_id "プロバイダーのユーザーID"
        datetime created_at "作成日時"
    }

    posts {
        integer post_id PK "投稿ID"
        integer user_id FK "投稿者ID"
        text content "投稿内容"
        datetime created_at "作成日時"
        datetime updated_at "更新日時"
    }

    post_images {
        integer image_id PK "画像ID"
        integer post_id FK "投稿ID"
        string image_url "画像URL"
        integer display_order "表示順"
    }

    tags {
        integer tag_id PK "タグID"
        string tag_name UK "タグ名 (#グルメ, #子育て)"
    }

    post_tags {
        integer post_id FK "投稿ID"
        integer tag_id FK "タグID"
    }

    follows {
        integer follower_id FK "フォローするユーザーID"
        integer following_id FK "フォローされるユーザーID"
        datetime created_at "フォロー日時"
    }

    likes {
        integer user_id FK "いいねしたユーザーID"
        integer post_id FK "いいねされた投稿ID"
        datetime created_at "いいね日時"
    }

    comments {
        integer comment_id PK "コメントID"
        integer post_id FK "投稿ID"
        integer user_id FK "コメントしたユーザーID"
        text content "コメント内容"
        datetime created_at "作成日時"
        datetime updated_at "更新日時"
    }

    bookmarks {
        integer user_id FK "ブックマークしたユーザーID"
        integer post_id FK "ブックマークされた投稿ID"
        datetime created_at "ブックマーク日時"
    }

    notifications {
        integer notification_id PK "通知ID"
        integer recipient_user_id FK "受信者ID"
        integer sender_user_id FK "送信者ID (NULL許容)"
        string type "通知タイプ (like, comment, follow, etc)"
        integer target_id "対象ID (post_id, user_idなど)"
        boolean is_read "既読フラグ"
        datetime created_at "作成日時"
    }

    questionnaires {
        integer questionnaire_id PK "アンケートID"
        string title "タイトル"
        text description "説明"
        integer points_reward "報酬ポイント"
        datetime deadline "締切日時"
        datetime created_at "作成日時"
    }

    user_questionnaire_answers {
        integer answer_id PK "回答ID"
        integer user_id FK "回答者ID"
        integer questionnaire_id FK "アンケートID"
        datetime answered_at "回答日時"
    }

    users ||--o{ social_logins : "has"
    users ||--o{ posts : "writes"
    users ||--o{ comments : "writes"
    users ||--o{ likes : "gives"
    users ||--o{ bookmarks : "saves"
    users ||--o{ notifications : "receives"
    users ||--o{ user_questionnaire_answers : "answers"

    posts ||--o{ post_images : "has"
    posts ||--o{ comments : "receives"
    posts ||--o{ likes : "receives"
    posts ||--o{ bookmarks : "is saved"

    posts }o--o{ tags : "has"
    post_tags }|--|| posts : "relates to"
    post_tags }|--|| tags : "relates to"

    questionnaires ||--o{ user_questionnaire_answers : "is answered"

    users }o--o{ users : "follows"
    follows }|--|| users : "is followed by (following_id)"
    follows }|--|| users : "follows (follower_id)"
```

### テーブル設計の解説

#### 1. `users`
- **役割**: アプリケーションのユーザー情報を格納する中心的なテーブルです。
- **カラム**:
  - `user_id`: 各ユーザーを一位に識別するID。
  - `username`, `email`: ログインや識別に利用。重複は許されません (UK: Unique Key)。
  - `password_hash`: パスワードを安全に保存するためのハッシュ化された文字列。
  - その他: プロフィール編集画面にある自己紹介、居住エリア、性別、生年月日などを保存します。

#### 2. `social_logins`
- **役割**: Facebook, Google, Appleなどのソーシャルログイン情報を管理します。
- **リレーション**: `users` テーブルと1対多の関係。1人のユーザーが複数のソーシャルアカウントを連携できます。

#### 3. `posts`
- **役割**: タイムラインに表示される投稿（テキストコンテンツ）を保存します。
- **リレーション**: `users` テーブルと1対多の関係。1人のユーザーが複数の投稿を行えます。

#### 4. `post_images`
- **役割**: 投稿に添付される画像を管理します。1つの投稿に複数画像を添付できるため、別テーブルに切り出します。
- **リレーション**: `posts` テーブルと1対多の関係。

#### 5. `tags` & `post_tags` (中間テーブル)
- **役割**:
  - `tags`: 「#グルメ」「#子育て」などのタグそのものを管理します。
  - `post_tags`: 投稿とタグの多対多の関係を表現するための中間テーブルです。1つの投稿に複数のタグを付けられ、1つのタグは複数の投稿で使われます。
- **リレーション**: `posts` - `post_tags` - `tags` で多対多を表現します。

#### 6. `follows`
- **役割**: ユーザー間のフォロー関係を管理します。誰が(follower_id)誰を(following_id)フォローしているかを記録します。
- **リレーション**: `users` テーブルに対する自己参照的な多対多の関係です。

#### 7. `likes`, `comments`, `bookmarks`
- **役割**: それぞれ投稿に対する「いいね」「コメント」「ブックマーク」のアクションを記録します。
- **リレーション**:
  - `likes`, `bookmarks`: 誰がどの投稿にアクションしたかを記録する中間テーブル。`users` と `posts` に対して多対多の関係を持ちます。
  - `comments`: 誰がどの投稿にコメントしたかと、その内容を記録します。`users` と `posts` に紐づきます。

#### 8. `notifications`
- **役割**: 「いいねされました」「コメントが付きました」といった通知を管理します。
- **カラム**:
  - `recipient_user_id`: 通知を受け取るユーザー。
  - `sender_user_id`: 通知のきっかけとなったアクションを起こしたユーザー（システム通知の場合はNULL）。
  - `type`, `target_id`: 何に対する通知か（例: type='like', target_id=投稿ID）。
- **リレーション**: `users` テーブルと1対多の関係（1人のユーザーが多くの通知を受け取る）。

#### 9. `questionnaires`
- **役割**: 「まちのアンケート」機能のアンケート情報を管理します。タイトル、締切、報酬ポイントなどを持ちます。

#### 10. `user_questionnaire_answers`
- **役割**: どのユーザーがどのアンケートに回答したかを記録する中間テーブルです。
- **リレーション**: `users` と `questionnaires` の多対多の関係を表現します。これにより、ユーザーごとに「未回答」「回答済」のアンケートを区別できます。